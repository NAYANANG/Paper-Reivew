# Deep learning for in vitro prediction of pharmaceutical formulations
## **개요**  
- 현재의 제약 제제 개발은 제약 과학자의 전통적인 시행착오 방법에 크게 의존하고 있다. 이 방식은 힘들고, 시간과 비용이 많이 든다.
- 최근 딥러닝은 자동 특징 추출 기능으로 인해 많은 영역에서 널리 적용되었다.  
- 본 연구의 목적은 딥러닝방법을 적용하여 제약제제를 예측하는 것이다.
    - 모델 시스템으로 2가지 유형의 투여형태를 선택
    - 모델의 성능을 평가하기 위해 제약학에 적합한 평가기준을 적용
    - 대표 데이터를 검증 및 테스트 데이터로 선택하기 위해 자동 데이터 세트 알고리즘 개발 
    - 6가지 머신러닝 방법을 딥러닝 방법과 비교
- 연구 결과, 두 심층신경망의 정확도가 80%이상이고 다른 기계학습 모델보다 높았다. 후자 신경망의 경우 약제학적 제형에 대한 좋은 예측을 보여주었다.  
- 자동 데이터 분할 알고리즘을 활용한 딥러닝과 제약 제제 데이터에 적합한 평가기준이 제약제제 예측을 위해 최초로 개발되었다. 약학과 인공지능의 학제 간 통합은 제약연구의 패러다임을 경험 의존 연구에서 데이터 기반방법론으로 바꿀 수 있을 것이다.

## **1. 소개**  
현대 제약 제제 개발은 제약 과학자들의 전통적인 시행 착오 접근법에 크게 의존하고 있다. 이러한 방법은 힘들고 시간과 비용 역시 많이 든다. 따라서, 제약 업계의 요구사항에 맞추어 배합 개발을 위한 효율적이고 체계적인 방법을 개발하는 것이 필요하다.  
머신러닝은 기존 시험 데이터로 데이터 기반 예측을 할 수 있기 때문에 효율적이고 빠르게 개발을 하고, 공식을 최적화하고, 비용을 절감할 수 있다. 또한 제품 일관성을 유지하고, 잘 정의된 영역의 전문가로부터 특정 지식을 축적 및 보존할 수 있다. ES와 ANN은 공식 개발을 위한 유용한 도구이다.  

    ES  
    - 축적 영역의 지식과 전문가의 경험을 보존  
    - 제약전문가의 모호한 경험을 ES의 규칙으로 추출하여 제형의 성능을 정확하게 예측하기 어려움  
    
    ANN
    - 제약 제제 예측에서 가장 널리 사용되는 기계 학습 도구
    - 생물학적 신경망의 구조와 기능을 시뮬레이션
    - 표준전문가 시스템이 해결하기 어려운 문제를 해결할 수 있음
    - 예측 프로세스에서 기능 추출을 설계하기 위한 전문지식이 필요
    - 제한된 실험 데이터로 인해 ANN에 의한 공식 예측 정확도가 상대적으로 낮음  
    
[최근 공식 설계에서 머신러닝의 진행]  
![formulation](https://user-images.githubusercontent.com/59431387/103633651-6182ad80-4f89-11eb-9a72-f41d19b1d076.PNG)  

딥러닝은 많은 분야에서 적용된 자동 범용 학습 절차이다. 기능 추출기를 설계하는 도메인 전문지식을 필요로 하는 머신러닝과 달리 자동으로 낮은 수준을 변환하는 기능 추출기는 더 높고 추상적인 수준이다. 또한, 머신러닝보다 깊은 학습과 높은 정밀성을 가지고 있다.  

    컨볼루션 신경망  
    - 로컬 연결 및 가중치 공유 가능
    - 이미지, 비디오, 음성, 오디오 처리에서 우수한 성능을 얻음  
    
    순환신경망  
    - 길이가 다른 시퀀스를 처리
    - 시퀀스의 히스토리 정보 활용 가능  

약제학적 제형 데이터는 제형 조성 및 제조공정이 포함되며, 이미지 데이터도 아니고 순차적 데이터도 아니다. 따라서 완전히 연결된 딥 피드 포워드 네트워크는 제약 제제 예측에 좋은 네트워크 일 것이다.  

    DNN  
    - 구강 붕해 정제 예측에서 하나의 숨겨진 레이어로 ANN을 능가함
    - 소그룹 필터 및 MD-FIS를 사용하는 Maximum Dissimilarity 알고리즘은 작고 불균형 한 구강 붕해 정제 데이터에서 대표 검증 세트를 선택함  

지난 5년간 연구에서 머신러닝을 통한 약물의 용해도 예측 학습과 딥러닝을 비교해본 결과 딥러닝이 다른 접근 방식에 비해 더 나은 성능을 달성한 것으로 나타났다. 이후 딥러닝은 많은 제약에 적용이 되었다. 예를 들면, 약물 독성을 줄이기 위해 분자의 반응성을 예측하기 위한 심층 회선 네트워크 개발, 얄물에 의한 간 손상 예측에 대한 깊은 학습, 독성을 예측하는 딥러닝 등이 있다. 특히 약물발견 DNN은 정략적 구조활동 관계 데이터 세트에 대해 다른 머신러닝 접근 방식보다 더 나은 예측을 할 수 있었다. 또한, 신약 발견에서 증가하는 데이터를 채굴하기 위해 딥러닝을 적용하여 과거로부터 학습할 수 있을 뿐만 아니라 향후 약물 용도 변경을 예측할 수도 있었다.  
본 논문에서는 회귀 모델을 구축하여 성공적인 제약 제제를 예측하기 위해 딥러닝을 적용하였다. 공식 예측의 주요 어려움 중 하나는 제한된 실험 데이터로 인해 입력 공간이 불균형 한 작은 데이터이다. 이를 해결하기 위하여 데이터 분할 알고리즘과 제약제제 데이터에 적합한 평가기준을 도입하였다. DNN은 OFDF 및 SRMT를 포함한 2가지 유형의 약제학적 투여형태의 데이터에 대해 훈련되었다. 그리고 다른 6가지의 머신러닝 기술과 딥러닝 기술을 비교하였다. 머신러닝과 딥러닝의 제약제제와 시험판 내 복접한 상관관계를 파악할 수 있었다. 이를 통해 제약 제제 예측에서 딥러닝 적용에 대한 광범위한 전망을 볼 수 있었다.  


## **2. 행동 양식**  
### **1) 제약데이터**
제약데이터 : 131개의 OFDF제형 + 145개의 SRMT제형으로 구성 (구강 속용성 필름, 구강 붕해 필름, 구강 분해성 필름 → OFDF제형의 개발에 대한 검색 문헌에 사용)  
실험데이터 : Web of Science에서 추출  
제형데이터 : 약물 및 부형제의 유형, 공정 매개변수 및 시험판 내제형  
→ 연구에서는 OFDF의 붕해시간과 SRMT의 누적 용해 프로파일을 포함하여 두가지 투여형태의 특성을 예측대상으로 선택

- 분자 설명자 : API속성을 나타냄
- 모든 약물의 이름은 분자냥, XlogP3, 수소결합 공여체수, 수소결합 수용체수, 회전 가능한 결합 수, 위상 극성 표면적, 중원자 수, 복잡성 및 logS를 포함하여 총 9개
- 부형제 유형 : 다른 숫자로 인코딩
- 공정 매개 변수 : 무게, 두께, 인장 강도, 연신율, 내구성, OFDF의 실제 약물 함량 및 과립화 공정, 직경, SRMT경도  

### **2) 데이터 분할**  
3개 데이터 세트(train/validation/test)가 사용됨  

### **3) 머신러닝의 하이퍼 파라미터**  
- 6개의 머신러닝 방법 도입(MLR, PLSR, SVM, ANN, RF, KNN)하여 DNN과 비교할 회귀모델을 구성  

   - ODFD의 경우  
        - PLSR에서 구성요소는 8개로 설정   
        - ANN에서 네트워크에 숨겨진 노트 80개가 있는 숨겨진 계층 1개가 포함되어 있음  
        - RF에서 트리의 최대 깊이 3으로 설정  
        - KNN에서 이웃수 5로 설정  
    - SRMT의 경우  
        - 4개의 모델이 4개의 시점 (2,4,6,8시간)동안 동시에 훈련됨  
        - 4개의 모델은 동일한 하이퍼 파라미터를 사용하여 개발  
        - PLSR 구성요소는 10개로 설정  
        - ANN 네트워크에는 60개의 숨겨진 노드가 있는 1개의 숨겨진 계층이 포함되어 있음  
        - RF에서 트리의 최대깊이는 5로 설정  
        - KNN에서 이웃수는 3으로 설정  

### **4) 심층 신경망의 하이퍼 파라미터**  
DeepLearning4j 기계학습 프레임 워크는 심층 신경망을 훈련하는데 사용되었다.

    OFDF의 경우  
        - layer 10, epoch 900인 피드포워드 신경망이 채택됨   
        - 이 네트워크에는 각 계층에 50게의 은닉 뉴런이 포함되어있음  
    SRMT의 경우   
        - layer 9, epoch 2600인 피드포워드 신경망이 채택됨  
        - 이 네트워크에는 각 계층에 30개의 은닉 뉴런이 포함되어 있음  

- 모든 네트워크에는 은닉층 활성화 함수로 tanh를 선택
- 마지막 계층에는 sigmoid 활성화 함수를 선택
- 학습률 0.01
- 배치경사하강법이 최적화 알고리즘으로 사용됨  

### **5) 평가기준**  
    - 상관계수 : 두 변수간의 선형관계를 나타냄  
    - 결정계수 : 예측값과 실제값 간의 상관관계를 나타냄  
그러나 제약학에서 약물 용해 프로파일을 예측하기 위한 좋은 모델은 10%미만의 오차를 가져야 하므로 상관계수와 결정계수는 약제학적 제형예측 모델의 성능을 제대로 평가할 수 없다.  

FDA의 유사성 계수를 사용하여 f를 약물 용출 양상의 유사성 평가, 유사성 인자 누적 약물출 곡선을 예측하는 모델의 성능을 평가하기 위해 도입되었다. f보다 크거나 같을 경우 성공적인 예측으로 평가된다. 누적약물 방출 곡선 예측의 정확도는 모든 예측에서 성공적인 예측 백분율 이다.  
![a](https://user-images.githubusercontent.com/59431387/104411567-f7cc5a00-55ad-11eb-8d01-669cce82e3e9.PNG)  
데이터 세트에서 OFDF의 분해시간은 0~100초이다. 일반적으로 성공적인 예측은 예측시간과 시험시간 사이의 오차가 10초 이하이다. 분해 시간 예측의 정확성도 모든 예측에서 성공한 예측 백분율이다.  
![b](https://user-images.githubusercontent.com/59431387/104411680-2d714300-55ae-11eb-978d-1379a943408a.PNG)  (f':예측된 값, f:실험값)

## **3. 결과 및 논의**  
### **1) 무작위 데이터 분할**  
    30%의 데이터는 검증세트로 무작위로 선택되었고, 나머지는 훈련세트로 사용되었다. 이 절차는 100회 반복하였다.  
그러나 완전히 다른 정확도 결과가 얻어졌고, 정확도의 최대 변동은 40%이상, 평균 정확도는 60%미만이었다. 따라서 무작위 데이터 분할은 예측 정화곧가 매우 낮고 변동이 클 수 있으므로 이 연구에 적합하지 않다는 결론이 도출되었다.  

### **2) 수동 데이터 분할**  
    각 제형에 대한 검증 세트로 20개의 대표 데이터를 선택하였다.  
훈련/검증 세트 모두에 대한 예측 정확도는 90%이상이었다. 그러나 수동 선택 방법에는 전문가의 도메인 지식이 필요하므로 대규모 데이터 세트에는 적합하지 않다. 따라서 유효성 검사 세트를 자동으로 선택하는 알고리즘을 개발해야 한다는 결론이 도출되었다.  

### **3) 데이분할의 최대비 유사성**  
    회대비 유사성 알고리즘이 화학데이터베이스에서 화합물의 대표적인 테스트 데이터를 선택한다. 하여 우리 연구에서도 최대비 유사성 알고리즘을 사용하여 검증세트를 선택하였다.
테스트 결과 검증세트의 정확도가 OFDF의 경우 83.46%, SRMT의 경우 78.85%에 불과했기 때문에 최대비 유사성 알고리즘이 데이터에서 제대로 작동하지 않는 것으로 나타났다.  

분할 결과를 분석한 결과, 최대 비 유사성 알고리즘이 a)작은 API그룸의 공식, b)경계 공식, c)비정상적인 값을 가진 공식에서 데이터를 선택하는 것이 선호됨을 발견하였다. 작은 API그룹데이터, 경계데이터, 비정상 데이터가 다른 데이터에 비해 다른 값이 더 크기 때문이다. 하지만 최대 비 유사성 알고리즘은 무작위로 생성된 초기 세트를 선택하여 비유사도를 계산하고, 여전히 매우 다양하고 작은 데이터 세트로 인해 강력하지는 않다. 따라서 원래의 최대 비 유사성 알고리즘을 개선할 필요가 있다.

### **4) 데이터 분할을 위한 MD-FIS 알고리즘**  
소그룹 필터 및 대표 초기 데이트 선택에 MD-FIS을 사용하여 개선된 Maximum Dissimilarity알고리즘을 보여준다.   

    MD-FIS 3단계 과정  
    1단계 : 데이터는 필터를 통해 작은 API그룹데이터를 제거
    2단계 : MD-FIS알고리즘은 10000개의 초기 데이터 세트를 무작위로 생성, 초기 데이터와 나머지 데이터 간의 유사성 값을 계산, 가장 높은 유사도 값을 가진 초기 데이터를 최종 데이터로 선택
    3단계 : 최종 초기 데이터와 나머지 데이터는 새로운 비용 함수를 사용하는 비 유사성 알고리즘에 대한 입력으로 사용. 새로운 비용 함수는 후보데이터와 초기 집합 간의 거리를 포함하고 후보데이터 또한 동일한 API그룹의 나머지 데이터 사이의 거리를 포함함.

![c](https://user-images.githubusercontent.com/59431387/104415417-534e1600-55b5-11eb-9412-d84ac9c77716.PNG)  
데이터 사이의 거리, 최대 비 유사성 알고리즘은 최대비용을 가진 데이터를 선택한다. 새로운 비용함수는 경계 데이터의 선택을 방지한다. 그 결과 원래의 최대 비 유사성 알고리즘보다 훨씬 좋아졌다. 검증 세트의 예측 정확도는 OFDF의 경우 95.57%, SRMT의 경우 82.02%이다.  
![d](https://user-images.githubusercontent.com/59431387/104415605-a6c06400-55b5-11eb-8f30-3c9083ed8af5.PNG)  


### **5) 평가기준**  
